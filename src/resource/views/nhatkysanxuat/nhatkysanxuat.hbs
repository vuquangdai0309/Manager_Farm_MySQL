<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Select2 CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet">
{{> header}}
{{>navbar}}
<main id="main" class="main">
    <div class="pagetitle">
        <div class="row">
            <div class="col-6">
                <h1>Nhật ký quá trình sản xuất </h1>
            </div>
            <div class="col-6">
                <div class="row justify-content-end">
                    <div class="col-md-4 mb-3">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                            data-bs-target="#exampleModal">
                            Thêm nhật ký
                        </button>
                    </div>
                    <div class="col-md-4 ">
                        <a href="/production-process-log/storeList">
                            <button type="button" class="btn btn-success">Danh
                                sách nhật ký</button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- End Page Title -->
    <section class="section dashboard">
        <div class="card">
            <div class="card-body">
                <div id="calendar"></div>
            </div>
        </div>

    </section>
    {{!-- models thêm --}}
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Thêm Nhật Ký Quá Trình Sản Xuất</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="add-event-form">
                        <form id="event-form" method="POST">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="row mb-3">
                                        <div class="col-lg-6">
                                            <label class="event-title">Giống cây</label>
                                            <select id="selectedTree" class="js-example-disabled-results form-select"
                                                aria-label="Default select example" name="tree_id" required>
                                                <option value="">Chọn giống cây</option>
                                                {{#each tree}}
                                                <option value="{{this._id}}">{{this.nameTree}}</option>
                                                {{/each}}
                                            </select>
                                        </div>
                                        <div class="col-lg-6">
                                            <label class="event-title">Tên nguyên vật liệu</label>
                                            <select id="selectedNguyenLieu"
                                                class="js-example-disabled-results form-control"
                                                name="nguyenvatlieu_id" required>
            
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <label class="event-title">Vụ mùa theo giống cây</label>
                                            <select id="selectedSeason" class="js-example-disabled-results form-select"
                                                aria-label="Default select example" name="season_id" required>
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <label class="event-title">Năm</label>
                                            <select class="js-example-disabled-results form-select"
                                                aria-label="Default select example" name="year_id" required>
                                                {{#each year}}
                                                <option value="{{this._id}}">{{this.year}}</option>
                                                {{/each}}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label class="event-title">Khu vực trồng (lô/thửa)</label>
                                        <select id="selectedArea" class=" js-example-disabled-results form-select"
                                            aria-label="Default select example" name="map_id" required>
                                            {{#each map}}
                                            <option value="{{this._id}}">{{this.namearea}}</option>
                                            {{/each}}
                                        </select>
                                    </div>
                                    
                                    <div class="form-group mb-3">
                                        <label class="event-title">Tên công việc</label>
                                        <input type="text" class="form-control" id="event-title" name="title" required>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="form-group col-lg-6">
                                            <label class="event-title">Thời gian bắt đầu</label>
                                            <input type="date" class="form-control" id="event-start" name="start"
                                                required>
                                        </div>
                                        <div class="form-group col-lg-6">
                                            <label class="event-title">Thời gian kết thúc</label>
                                            <input type="date" class="form-control" id="event-end" name="end" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="row">
                                        <div class="form-group col-lg-6">
                                            <label class="event-title">Nồng độ pha/bón</label>
                                            <input type="text" class="form-control" id="nongdo" name="nongdo" required>
                                        </div>
                                        <br>
                                        <div class="form-group col-lg-6">
                                            <label class="event-title">Tổng lượng sử dụng</label>
                                            <input type="text" class="form-control" id="luongsudung" name="luongsudung"
                                                required>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group">
                                        <label class="event-title">Thời gian cách ly</label>
                                        <input type="text" class="form-control" id="thoigiancachly"
                                            name="thoigiancachly" required>
                                    </div>
                                    <br>
                                    <div class="form-group">
                                        <label for="exampleFormControlTextarea1">Mục đích sử dụng</label>
                                        <input class="form-control" id="mucdich" name="mucdich" rows="3" required>
                                    </div>
                                    <br>
                                    <div class="form-group">
                                        <label class="event-title">Thiết bị sử dụng</label>
                                        <input type="text" class="form-control" id="thietbi" name="thietbi" required>
                                    </div>
                                    <br>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="mySwitch"
                                            name="vesinhdungcu" value="Đúng" checked>
                                        <label class="form-check-label" for="mySwitch">Vệ sinh dụng cụ trước và sau khi
                                            sử dụng
                                            (Đ/K)</label>
                                    </div>

                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary"
                                    style="width:250px;float:right;margin-left:20px">Thêm Mới
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{{> footer}}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/5.3.0-alpha1/js/bootstrap.bundle.min.js"></script>
<!-- Select2 JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js'></script>

<script>

    $('#exampleModal').on('shown.bs.modal', function () {
        $(".js-example-disabled-results").select2({
            dropdownParent: $('#exampleModal') // Xác định modal là cha của dropdown
        });
    });
    // method delete 

    //Show calendar
    function formatDate(dateString) {
        const parts = dateString.split('-');
        if (parts.length === 3) {
            return parts[2] + '-' + parts[1] + '-' + parts[0];
        }
        return dateString;
    }
    function Onclick() {

        $.ajax({
            url: '/production-process-log/store',
            type: 'GET',

        }).then(data => {
            function LoadData(dataWork) {
                var calendarEl = document.getElementById('calendar');
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',

                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    events: dataWork,
                    locale: 'vi',

                },
                );
                calendar.render();

            }
            LoadData(data.nhatkysanxuat.map(obj => {
                return {
                    title: obj.title,
                    start: formatDate(obj.start),
                    end: formatDate(obj.end)
                }

            }))
        })
            .catch(err => {
                console.log(err)
            })
    }
    Onclick()
</script>
<script src="/js/inputSelectNhatKy.js"></script>